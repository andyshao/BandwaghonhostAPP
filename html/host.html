<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="../js/mui.min.js"></script>
    <link href="../css/mui.min.css" rel="stylesheet"/>
    <script type="text/javascript" charset="UTF-8">
      	mui.init();
		var datastring;
		mui.plusReady(function(){
			var self=plus.webview.currentWebview();
			datastring=self.data;
			mui.toast('正在获取数据信息');
			vgetinfo(datastring);
		})
		
    </script>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
	    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
	    <h1 class="mui-title">主机控制台</h1>
	   
	</header>
	<div class="mui-content">
	    <ul class="mui-table-view">
	                   <li class="mui-table-view-cell">
	                       <a class=>
	                        主机名：<span class="mui-badge mui-badge-purple" id='hostname'></span>

	                       </a>
	                   </li>
	                   <li class="mui-table-view-cell">
	                       <a class="">
	           		 IP:<span class="mui-badge mui-badge-purple" id="ip"></span>

	                       </a>
	                   </li>
	                   <li class="mui-table-view-cell">
	                       <a class="">
	           		 SSH端口:<span class="mui-badge mui-badge-purple" id="ssh"></span>

	                       </a>
	                   </li>
	                  
	                   <li class="mui-table-view-cell">
	                       <a class="">
	                   月流量:<span class="mui-badge mui-badge-purple" id="bandwidth"></span>

	                       </a>
	                   </li>
	                   						<li class="mui-table-view-cell">
	                       <a class="">
	                   已用流量:<span class="mui-badge mui-badge-purple" id="usewidth"></span>

	                       </a>
	                   </li>
	                   <li class="mui-table-view-cell">
	                       <a class="">
	                   重置日期:<span class="mui-badge mui-badge-purple" id='refresh'></span>

	                       </a>
	                   </li>
	                   <li class="mui-table-view-cell">
	                       <a class="">
	                   当前负载:<span class="mui-badge mui-badge-purple" id='load'></span>

	                       </a>
	                   </li>
	                   <li class="mui-table-view-cell">
	                       <a class="">
	                   节点:<span class="mui-badge mui-badge-purple" id='location'></span>

	                       </a>
	                   </li>
	                   <li class="mui-table-view-cell">
	                       <a class="">
	                   操作系统:<span class="mui-badge mui-badge-purple" id='os'></span>

	                       </a>
	                   </li>
	                   <li class="mui-table-view-cell">
	                       <a class="">
	                   当前状态:<span class="mui-badge mui-badge-purple" id='status'></span>
	                       </a>
	                   </li>
	               </ul>
	              <div class="mui-content-padded">
	                  <ul class="mui-table-view mui-grid-view mui-grid-9">
	                      <li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
	                          <a id="arefresh">
	                              <span class="mui-icon mui-icon-refresh"></span>
	                              <div class="mui-media-body">刷新</div>
	                          </a>
	                      </li>
	                      <li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
	                          <a id="astart">
	                              <span class="mui-icon mui-icon-paperplane"></span>
	                              <div class="mui-media-body">启动</div>
	                          </a>
	                      </li>
	                      <li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
	                          <a id="aclose">
	                              <span class="mui-icon mui-icon-close"></span>
	                              <div class="mui-media-body">关闭</div>
	                          </a>
	                      </li>
	                      <li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
	                          <a id="arestart">
	                              <span class="mui-icon mui-icon-spinner-cycle"></span>
	                              <div class="mui-media-body">重启</div>
	                          </a>
	                      </li>
	                  </ul>
	              </div>
	</div>
	<script>
		//监听操作
		document.getElementById('arestart').addEventListener('tap',function(){
			mui.toast('正在重启机器.....');
			vrestart(datastring);
		});
		document.getElementById('arefresh').addEventListener('tap',function(){
			mui.toast('正在更新信息.....');
			vgetinfo(datastring);
		});
		document.getElementById('astart').addEventListener('tap',function(){
			mui.toast('正在启动机器.....');
			vstart(datastring);
		});
		document.getElementById('aclose').addEventListener('tap',function(){
			mui.toast('正在停止机器.....');
			vstop(datastring);
		});
		//时间处理函数
		function getLocalTime(nS) {     
		   return new Date(parseInt(nS) * 1000).toLocaleString().replace(/:\d{1,2}$/,' ');     
		} 
		//数字截取函数
		function ForDight(Dight,How){    
            Dight = Math.round(Dight*Math.pow(10,How))/Math.pow(10,How);    
            return Dight;    
        } 
        //API操作
		function vgetinfo(data){
			data = eval('(' + data + ')');   
			mui.post('http://cloud.bmob.cn/4c7d88c789a79ea7/getLiveInfo',{veid:data.veid,key:data.key},function(data){
				var dataObj=eval("("+data+")");
				document.getElementById('os').innerText=dataObj.os;
				document.getElementById('hostname').innerText=dataObj.vz_status.hostname;
				document.getElementById('load').innerText=dataObj.vz_status.load_average;
				document.getElementById('status').innerText=dataObj.vz_status.status;
				document.getElementById('ip').innerText=dataObj.ip_addresses;
				document.getElementById('bandwidth').innerText=dataObj.plan_monthly_data/1073741824+'GB';
				document.getElementById('location').innerText=dataObj.node_location;
				document.getElementById('refresh').innerText=getLocalTime(dataObj.data_next_reset);
				document.getElementById('ssh').innerText=dataObj.ssh_port;
				usebanwidth=dataObj.data_counter/1073741824;
				usebanwidth=ForDight(usebanwidth,2);
				document.getElementById('usewidth').innerText=usebanwidth+'GB';
				mui.toast('信息获取完成！');
			}
			);
		}
		function vstart(data){
			data = eval('(' + data + ')');   
			mui.post('http://cloud.bmob.cn/4c7d88c789a79ea7/getStart',{veid:data.veid,key:data.key},function(data){
				var dataObj=eval("("+data+")");
				if (dataObj.error == 0)
				{
					mui.toast('启动成功！请刷新查看状态')
				}else
				{
					mui.toast('启动失败！')
				}
			})
		}
		function vstop(data){
			data = eval('(' + data + ')');   
			mui.post('http://cloud.bmob.cn/4c7d88c789a79ea7/getStop',{veid:data.veid,key:data.key},function(data){
				var dataObj=eval("("+data+")");
				if (dataObj.error == 0)
				{
					
					mui.toast('停止成功！请刷新查看状态')
				}else
				{
					mui.toast('停止失败！')
				}
			})
		}
		function vrestart(data){
			data = eval('(' + data + ')');   
			mui.post('http://cloud.bmob.cn/4c7d88c789a79ea7/getRestart',{veid:data.veid,key:data.key},function(data){
				var dataObj=eval("("+data+")");
				if (dataObj.error == 0)
				{
					mui.toast('重启成功！请刷新查看状态')
				}else
				{
					mui.toast('重启失败！')
				}
			});
		}
	</script>
</body>
</html>